# Метрики Docker daemon и контейнеров

Docker демон умеет отдавать метрики, по умолчанию эта опция выключена, но можно ее включить
Открываем файл /etc/docker/daemon.json и добавляем туда в общий конфиг
'''
{
    "experimental": true,
    "metrics-addr": "0.0.0.0:9100"
}
'''
см. пример
![metrics-cfg](metrics-cfg.png)

Чтобы посмотреть метриуи зайдем на этот порт
'''
curl 127.0.0.0:9100/metrics
'''

И увидим там кучу метрик

Но если нам недостаточно встроенных метрик
Для этого существуют внешнии экспортеры
например
https://github.com/draganm/missing-container-metrics
выдает метрики, когда контейнер падает. Очень полезная

Или написать свой экспортер

## Метрики приложений
Хорошее приложение всегда отдает свои метрики, для этого просто публикуем нужный порт (9090):
'''
docker run -p 8080:8080 -p 9090:9090 my-app
'''
Желатеьно отдавать их на /metrics

## Docker stats
Запускается командой
'''
Docker stats
'''
Показывает текущее потребление ресоврос контейнера
![docker-stats](docker-stats.png)
Хранит он это все в псевдовфайлах, в этих файлах информации будет чуть больше, Но это все не 
очень удобно, поэтому есть такая штука как Cadvisor

## Cadvisor
Очень популярная штука - Она отдает метрики в удобной форме
Ставим ее на докер хост и она будет забирать все метрики из вышеуказынных файлов и отдает их нам 
в прометеус совметимом формате.

## Ctop
Показывает тоже самое как Docker stats, но немного удобней
